const $canvas=document.querySelector(".js-canvas"),context=$canvas.getContext("2d"),$gameTitle=document.querySelector(".game__title"),$winner=$gameTitle.querySelector(".game__winner"),$winnerValue=$winner.querySelector(".value"),$scorePlayer1=document.querySelector(".js-value1"),$scorePlayer2=document.querySelector(".js-value2"),$sounds=document.querySelector(".sounds"),musics=$sounds.querySelectorAll(".js-audio");let boostInterval,currentMusic,windowWidth=window.innerWidth,windowHeight=window.innerHeight,gameOver=!1,scorePlayer1=0,scorePlayer2=0,boost=null;$canvas.width=windowWidth,$canvas.height=windowHeight;const resize=()=>{windowWidth=window.innerWidth,windowHeight=window.innerHeight,$canvas.width=windowWidth,$canvas.height=windowHeight,drawWorld()};window.addEventListener("resize",resize);const drawWorld=()=>{context.beginPath(),context.lineTo($canvas.width,0),context.lineTo($canvas.width,$canvas.height),context.lineTo(0,$canvas.height),context.lineTo(0,0),context.closePath(),context.shadowOffsetX=0,context.shadowOffsetY=0,context.shadowBlur=10,context.shadowColor="white",context.lineWidth=2,context.strokeStyle="white",context.stroke()},player1={};player1.name="Player 1",player1.x=100*Math.random()+50,player1.y=100*Math.random()+50,player1.angleDirection=0,player1.speed=2.5,player1.color=document.getElementById("color1").value,player1.olderPosition=[[player1.x,player1.y]];const player2={};player2.name="Player 2",player2.x=100*Math.random()+(windowWidth-150),player2.y=100*Math.random()+(windowHeight-150),player2.angleDirection=Math.PI,player2.speed=2.5,player2.color=document.getElementById("color2").value,player2.olderPosition=[[player2.x,player2.y]];const drawPlayer=e=>{context.beginPath(),context.shadowOffsetX=0,context.shadowOffsetY=0,context.shadowBlur=10,context.shadowColor=e.color,context.lineWidth=.8,context.strokeStyle=e.color,context.arc(e.x,e.y,5,0,2*Math.PI),context.stroke()},move=e=>{gameOver||(window.requestAnimationFrame(()=>{move(e),null!=boost&&detectBoostCollision(e,boost)}),e.x+=Math.cos(e.angleDirection)*e.speed,e.y-=Math.sin(e.angleDirection)*e.speed,e.olderPosition.push([e.x,e.y]),collisions(),drawPlayer(e))};let map={};onkeydown=onkeyup=function(e){map[e.keyCode]="keydown"==e.type,1==map[37]&&(player2.angleDirection+=.4),1==map[39]&&(player2.angleDirection-=.4),1==map[69]&&(player1.angleDirection-=.4),1==map[65]&&(player1.angleDirection+=.4)};const detectPlayerCollision=(e,t)=>{const o={x:windowWidth/2+e.x,y:windowHeight/2+e.y};for(let n=0;n<t.olderPosition.length;n++){const a={x:windowWidth/2+t.olderPosition[n][0],y:windowHeight/2+t.olderPosition[n][1]},r=o.x-a.x,l=o.y-a.y;Math.sqrt(r*r+l*l)<10&&!gameOver&&endGame(e)}},detectSelfCollision=e=>{if(e.olderPosition.length>10){const t={x:windowWidth/2+e.x,y:windowHeight/2+e.y};for(let o=0;o<e.olderPosition.length-10;o++){const n={x:windowWidth/2+e.olderPosition[o][0],y:windowHeight/2+e.olderPosition[o][1]},a=t.x-n.x,r=t.y-n.y;Math.sqrt(a*a+r*r)<10&&!gameOver&&endGame(e)}}},detectBorderCollision=e=>{e.x<0&&(e.x=windowWidth),e.y>windowHeight&&(e.y=0),e.y<0&&(e.y=windowHeight),e.x>windowWidth&&(e.x=0)},detectBoostCollision=(e,t)=>{const o={x:windowWidth/2+e.x,y:windowHeight/2+e.y},n={x:windowWidth/2+t.x,y:windowHeight/2+t.y},a=o.x-n.x,r=o.y-n.y;if(Math.sqrt(a*a+r*r)<10){context.save(),context.arc(t.x,t.y,5,0,2*Math.PI),context.clip(),context.clearRect(0,0,$canvas.width,$canvas.height),context.restore(),boost=null;const o=e.speed;e.speed*=2,setTimeout(()=>{e.speed=o},1e3)}},collisions=()=>{detectPlayerCollision(player1,player2),detectPlayerCollision(player2,player1),detectSelfCollision(player1),detectSelfCollision(player2),detectBorderCollision(player1),detectBorderCollision(player2)},generateBoost=()=>{null!=boost&&(context.save(),context.arc(boost.x,boost.y,5.5,0,2*Math.PI),context.clip(),context.clearRect(0,0,$canvas.width,$canvas.height),context.restore()),(boost=new Boost(windowWidth,windowHeight,context)).draw()},render=()=>{gameOver=!1,$canvas.style.visibility="visible",$gameTitle.style.display="none",player1.color=document.getElementById("color1").value,player2.color=document.getElementById("color2").value,(currentMusic=musics[Math.floor(Math.random()*musics.length)]).play(),resize(),move(player1),move(player2),generateBoost(),boostInterval=setInterval(generateBoost,1e4)},endGame=e=>{gameOver=!0,clearInterval(boostInterval);const t=e==player1?player2.name:player1.name;iterateScore(t),currentMusic.pause(),setTimeout(()=>{$canvas.style.visibility="hidden",$gameTitle.style.display="block",$winnerValue.textContent=t,$winner.style.display="block"},100)},iterateScore=e=>{e==player1.name?(scorePlayer1++,$scorePlayer1.textContent=scorePlayer1):(scorePlayer2++,$scorePlayer2.textContent=scorePlayer2)},resetWorld=()=>{boost=null,context.clearRect(0,0,$canvas.width,$canvas.height),player1.x=100*Math.random()+50,player1.y=100*Math.random()+50,player1.angleDirection=0,player1.speed=2.5,player1.olderPosition=[[player1.x,player1.y]],player2.x=100*Math.random()+(windowWidth-150),player2.y=100*Math.random()+(windowHeight-150),player2.angleDirection=Math.PI,player2.speed=2.5,player2.olderPosition=[[player2.x,player2.y]]},$launcher=document.querySelector(".js-launcher");$launcher.addEventListener("click",()=>{resetWorld(),render()});