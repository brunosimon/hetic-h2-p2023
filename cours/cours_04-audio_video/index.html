<!doctype html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <title>TRIM 1 - Cours 04 - Audio / Video</title>
        <meta name="description" content="">
        <meta name="author" content="Bruno Simon">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <link rel="stylesheet" href="../src/reveal.js/css/reveal.css">
        <link rel="stylesheet" href="../src/reveal.js/css/theme/orange.css" id="theme">
        <!-- <link rel="stylesheet" href="../src/reveal.js/lib/css/highlight/railscasts.css"> -->
        <!-- <link rel="stylesheet" href="../src/reveal.js/lib/css/highlight/github.css"> -->
        <link rel="stylesheet" href="../src/custom/style.css">
        <script>
            document.write( '<link rel="stylesheet" href="../src/reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
        </script>
        <!--[if lt IE 9]>
            <script src="../src/reveal.js/lib/js/html5shiv.js"></script>
        <![endif]-->

        <!-- Code steps start -->
        <link rel="stylesheet" href="../src/code-steps/prism-tomorrow.css">
        <link rel="stylesheet" href="../src/code-steps/style.css">
        <!-- Code steps end -->
    </head>
    <body>
        <div class="reveal">
            <div class="slides">
                <section>
                    <h3>H2 - P2023</h3>
                    <h1>Développement web</h1>
                    <h3>Cours 04</h3>
                    <ul>
                        <li>github : <a target="_blank" href="https://github.com/brunosimon/hetic-p2023">https://github.com/brunosimon/hetic-p2023</a></li>
                        <li>site : <a target="_blank" href="http://bruno-simon.com/hetic/p2023/">http://bruno-simon.com/hetic/p2023/</a></li>
                        <li>contact : <a target="_blank" mailto="bruno.simon@hetic.net">bruno.simon@hetic.net</a></li>
                    </ul>
                </section>

                <section>
                    <h3>HTML5</h3>
                    <h1>Audio / Video</h1>
                </section>

                <section>
                    <p><span class="hl">APIs HTML5</span> permettant de lire des fichiers audio et vidéo directement dans la page à travers les balises <span class="hl">&lt;audio&gt;</span> et <span class="hl">&lt;video&gt;</span> sans utiliser Flash</p>
                </section>

                <!-- AUDIO -->
                <section>
                    <h2>Audio</h2>
                </section>

                <section>
                    <h2>Exemples</h2>
                    <div
                        class="code-steps"
                        data-type="html"
                        data-trim
                    >
                        <pre contenteditable><code>
&lt;audio src="audio.mp3"&gt;&lt;/audio&gt;
                        </code></pre>
                    </div>
                </section>

                <section>
                    <p>Message de fallback pour les visiteurs dont le navigateur ne supporte pas l'audio</p>
                    <div
                        class="code-steps"
                        data-type="html"
                        data-trim
                    >
                        <pre contenteditable><code>
&lt;audio src="audio.mp3"&gt;
    Your browser doesn't support video API
&lt;/audio&gt;
                        </code></pre>
                    </div>
                </section>

                <section>
                    <h2>Attributs</h2>
                    <ul>
                        <li><span class="hl">src</span> Fichier source</li>
                        <li><span class="hl">controls</span> Affiche un controlleur (propre au navigateur)</li>
                        <li><span class="hl">autoplay</span> Lance la lecture dès que le fichier suffisamment chargé</li>
                        <li><span class="hl">loop</span> Recommence la lecture à la fin</li>
                        <li><span class="hl">muted</span> Couper le son</li>
                        <li><span class="hl">preload</span> Choix du pré-chargement (auto / metadata / none)</li>
                    </ul>
                </section>

                <section>
                    <p>Preload n'est qu'une indication pour le navigateur. Ce dernier peut choisir de l'ignorer.</p>
                    <ul>
                        <li><span class="hl">auto</span> Charge tout le fichier</li>
                        <li><span class="hl">metadata</span> Ne charge que les informations (length, width, height)</li>
                        <li><span class="hl">none</span> Ne charge rien</li>
                    </ul>
                </section>

                <section>
                    <p>Il est inutile d'indiquer une valeurs aux attributs qui n'en nécessitent pas</p>
                    <div
                        class="code-steps"
                        data-type="html"
                        data-trim
                    >
                        <pre contenteditable><code>
&lt;audio 
    src="audio.mp3"
    controls
    autoplay
    loop
    muted
&gt;&lt;/audio&gt;
                        </code></pre>
                    </div>
                </section>

                <section>
                    <h2>Controllers</h2>
                    <ul>
                        <li>Chrome<br><img width="400" src="src/img/audio-controls-chrome.png" alt="Controls Chrome"></li>
                        <li>Firefox<br><img width="400" src="src/img/audio-controls-firefox.png" alt="Controls Firefox"></li>
                        <li>Safari<br><img width="400" src="src/img/audio-controls-safari.png" alt="Controls Safari"></li>
                    </ul>
                </section>

                <section>
                    <h2>Formats</h2>
                    <p>Il est possible d'envoyer plusieurs formats et de laisser le navigateur choisir celui qu'il préfère</p>
                    <div
                        class="code-steps"
                        data-type="html"
                        data-trim
                    >
                        <pre contenteditable><code>
&lt;audio autoplay="autoplay" loop="loop" controls="controls"&gt;
    &lt;source src="audio.mp3" type="audio/mp3" /&gt;
    &lt;source src="audio.ogg" type="audio/ogg" /&gt;
    Your browser doesn't support audio API
&lt;/audio&gt;
                        </code></pre>
                    </div>
                </section>

                <section>
                    <h2>Compatibilité</h2>
                    <p><a target="_blank" href="http://caniuse.com/#feat=audio">http://caniuse.com/#feat=audio</a></p>
                    <p class="ciu_embed" data-feature="audio" data-periods="future_1,current,past_1,past_2,past_3,past_4">
                        <a href="http://caniuse.com/#feat=audio">CanIUse</a>
                    </p>
                </section>

                <!-- VIDEO -->
                <section>
                    <h2>Video</h2>
                    <p class="fragment">Comme l'API audio mais on remplace par <span class="u">video</span>...</p>
                </section>

                <section>
                    <h2>Exemples</h2>
                    <p>Le plus simple</p>
                    <div
                        class="code-steps"
                        data-type="html"
                        data-trim
                    >
                        <pre contenteditable><code>
&lt;video src="video.mp4"&gt;&lt;/video&gt;
                        </code></pre>
                    </div>
                </section>

                <section>
                    <p>Message de fallback pour les visiteurs dont le navigateur ne supporte pas la vidéo</p>
                    <div
                        class="code-steps"
                        data-type="html"
                        data-trim
                    >
                        <pre contenteditable><code>
&lt;video src="video.mp4"&gt;
    Your browser doesn't support video API
&lt;/video&gt;
                        </code></pre>
                    </div>
                </section>

                <section>
                    <h2>Attributs</h2>
                    <ul>
                        <li><span class="hl">src</span> Fichier source</li>
                        <li><span class="hl">controls</span> Affiche un controlleur (propre au navigateur)</li>
                        <li><span class="hl">autoplay</span> Lance la lecture dès que le fichier suffisamment chargé</li>
                        <li><span class="hl">loop</span> Recommence la lecture à la fin</li>
                        <li><span class="hl">preload</span> Choix du pré-chargement (auto / metadata / none)</li>
                        <li><span class="hl">muted</span> Couper le son</li>
                    </ul>
                </section>

                <section>
                    <p>Preload n'est qu'une indication pour le navigateur. Ce dernier peut choisir de l'ignorer.</p>
                    <ul>
                        <li><span class="hl">auto</span> Charge tout le fichier</li>
                        <li><span class="hl">metadata</span> Ne charge que les informations (length, width, height)</li>
                        <li><span class="hl">none</span> Ne charge rien</li>
                    </ul>
                </section>

                <section>
                    <ul>
                        <li><span class="hl">width</span> Largeur du player</li>
                        <li><span class="hl">height</span> Hauteur du player</li>
                        <li><span class="hl">poster</span> Lien de l'image de presentation de la vidéo</li>
                    </ul>
                </section>

                <section>
                    <p>Il est inutile d'indiquer une valeurs aux attributs qui n'en nécessitent pas</p>
                    <div
                        class="code-steps"
                        data-type="html"
                        data-trim
                    >
                        <pre contenteditable><code>
&lt;video 
    src="video.mp4" 
    poster="image.jpg"
    controls
    autoplay
    loop
    muted
    width="800"
    height="600"
&gt;&lt;/video&gt;
                        </code></pre>
                    </div>
                </section>

                <section>
                    <h2>Formats</h2>
                    <p>Il est possible d'envoyer plusieurs formats et de laisser le navigateur choisir celui qu'il préfère</p>
                    <p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Supported_media_formats#Browser_compatibility" target="_blank">Support des formats</a></p>
                    <div
                        class="code-steps"
                        data-type="html"
                        data-trim
                    >
                        <pre contenteditable><code>
&lt;video autoplay="autoplay" loop="loop" controls="controls" width="800"&gt;
    &lt;source src="video.mp4" type="video/mp4" /&gt;
    &lt;source src="video.webm" type="video/webm" /&gt;
    &lt;source src="video.ogv" type="video/ogg" /&gt;
    Your browser doesn't support video API
&lt;/video&gt;
                        </code></pre>
                    </div>
                </section>

                <section>
                    <ul>
                        <li><a target="blank" href="http://fr.wikipedia.org/wiki/Theora">Theora</a> (ogg, ogv) : Libre et gratuit (Firefox)</li>
                        <li><a target="_blank" href="http://fr.wikipedia.org/wiki/WebM" >WebM</a> : Libre et gratuit (Chrome)</li>
                        <li><a target="_blank" href="http://fr.wikipedia.org/wiki/H.264">MPEG-4</a> : Non-libre et payant</li>
                    </ul>
                </section>

                <section>
                    <h2>Conversion / Compression</h2>
                </section>

                <section>
                    <p>Logiciels</p>
                    <ul>
                        <li>
                            <a target="_blank" href="http://www.mirovideoconverter.com/">Miro Video Converter</a>
                            <br>Video - Simple - Gratuit - Mac et Windows
                        </li>
                        <li>
                            <a target="_blank" href="https://handbrake.fr/">HandBrake</a>
                            <br>Video - Complexe - Gratuit - Mac, Windows et Linux
                        </li>
                        <li>
                            <a target="_blank" href="https://www.adobe.com/fr/products/media-encoder.html">Adobe Media Encoder</a>
                            <br>Audio et video - Complexe - Payant - Mac, Windows
                        </li>
                    </ul>
                </section>

                <section>
                    <p>En ligne</p>
                    <ul>
                        <li>
                            <a target="_blank" href="https://www.online-convert.com/">Online Convert</a>
                            <br><a target="_blank" href="https://video.online-convert.com/convert-to-mp4">Audio</a> et <a target="_blank" href="https://audio.online-convert.com/convert-to-mp3">audio</a> - Un peu complexe - Gratuit
                        </li>
                    </ul>
                </section>

                <section>
                    <p>Guides</p>
                    <p><a href="https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Audio_codecs" target="_blank">Audio</a></p>
                    <p><a href="https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Video_codecs" target="_blank">Video</a></p>
                </section>

                <section>
                    <h2>Compatibilité</h2>
                    <p><a target="_blank" href="http://caniuse.com/#feat=video">http://caniuse.com/#feat=video</a></p>
                    <p class="ciu_embed" data-feature="video" data-periods="future_1,current,past_1,past_2,past_3,past_4">
                        <a href="http://caniuse.com/#feat=video">CanIUse</a>
                    </p>
                </section>

                <!-- Autoplay policy -->
                <section>
                    <h2>Politique d'autoplay sur Chrome</h2>
                    <p>
                        <a target="_blank" href="https://developers.google.com/web/updates/2017/09/autoplay-policy-changes">Articles officiel</a>
                    </p>
                </section>

                <section>
                    <p>Chrome peut choisir de ne pas jouer la vidéo si l'utilisateur n'a pas accompli d'action dans la page<br>(click ou touch)</p>
                    <p>Permet d'endiguer la lecture de medias non solicités (publicités)</p>
                    <p>Censé être bon pour les utilisateurs, mais mauvais pour les dévelopeurs</p>
                </section>

                <section>
                    <p>L'autoplay va fonctionner si</p>
                    <ul>
                        <li>La vidéo est muted</li>
                        <li>L'utilisateur a accompli une action dans la page (click ou touch)</li>
                        <li>Le score de media engagement du site est assez élevé (l'utilisateur à déjà regardé des vidéos sur le site)</li>
                    </ul>
                    <p>Vérifier son score de media engagement : <a target="_blank" href="chrome://media-engagement">chrome://media-engagement</a></p>
                </section>

                <section>
                    <p>Vous devez concevoir votre site en gardant en tête que l'autoplay ne fonctionne pas forcément</p>
                    <ul>
                        <li>Retirer l'autoplay des attributs</li>
                        <li>Lancer la lecture en JS et <a target="_blank" href="https://developers.google.com/web/updates/2017/09/autoplay-policy-changes#audiovideo_elements">catcher l'erreur</a> dans le cas où la lecture n'a pas fonctionné</li>
                        <li>Faire apparaître un bouton <span class="u">play</span></li>
                        <li>Lorsque l'utilisateur click sur le bouton, le faire disparaître et lancer la lecture</li>
                    </ul>
                </section>

                <section>
                    <p>⚠️ Pensez bien à cette contrainte durant la phase de conception</p>
                </section>

                <!-- CONTROLS JS -->
                <section>
                    <h2>Manipuler en Javascript</h2>
                </section>

                <section>
                    <p>Avant tout, il faut récupérer l'élément et le sauvegarder dans une variable.</p>
                    <div
                        class="code-steps"
                        data-type="javascript"
                        data-trim
                        data-steps="
                            *:En assumant qu'on a qu'une seule &lt;video&gt
                        "
                    >
                        <pre contenteditable><code>
const video = document.querySelector('video')
                        </code></pre>
                    </div>
                    <p>Une fois récupéré, on va pouvoir utiliser ses méthodes et modifier ses propriétés</p>
                </section>

                <section>
                    <p>En JS orienté objet, les objets fonctionnent avec des méthodes, des propriétés et des événements.</p>
                    <p>Prenons en exemple un humain.</p>
                    <ul>
                        <li>
                            <span class="u">Méthodes</span> : marche, cours, saute
                            <br>Ce sont des actions qu'on peut lui faire faire
                        </li>
                        <li>
                            <span class="u">Propriétés</span> : âge, hauteur, poids
                            <br>Ce sont des informations qu'on peut récupérer et modifier
                        </li>
                        <li>
                            <span class="u">Événements</span> : se réveille, s'endort, anniversaire
                            <br>Ce sont des événements qu'on peut écouter 
                        </li>
                    </ul>
                </section>

                <section>
                    <p>Les objets audio et video fonctionnent de la même manière</p>
                </section>

                <section>
                    <h2>Méthodes</h2>
                    <div
                        class="code-steps"
                        data-type="javascript"
                        data-trim
                        data-steps="
                            *:;
                            l1:Lance la lecture;
                            l2:Met en pause
                        "
                    >
                        <pre contenteditable><code>
video.play()
video.pause()
                        </code></pre>
                    </div>
                </section>

                <section>
                    <h2>Propriétés</h2>

                    <p>Les propriétés permettent de récupérer des infos</p>

                    <div
                        class="code-steps"
                        data-type="javascript"
                        data-trim
                        data-steps="
                            *:;
                            l1:Log si les contrôles sont visibles;
                            l2:Log si la vidéo boucle;
                            l3:Log si la vidéo joue automatiquement;
                            l4:Log si le son est coupé;
                            l5:Log le volume de la vidéo;
                            l6:Log à quel moment en est la lecture (en secondes);
                            l7:Log la durée de la vidéo
                        "
                    >
                        <pre contenteditable><code>
console.log(video.controls)
console.log(video.loop)
console.log(video.autoplay)
console.log(video.muted)
console.log(video.volume)
console.log(video.currentTime)
console.log(video.duration)
                        </code></pre>
                    </div>
                </section>

                <section>
                    <h2>Propriétés</h2>

                    <p>Certaines de ces informations peuvent être modifées</p>

                    <div
                        class="code-steps"
                        data-type="javascript"
                        data-trim
                        data-steps="
                            *:;
                            l1:Cache les contrôles;
                            l2:Augmente légèrement le volume;
                            l3:Place la lecture de la vidéo à la moitiée de sa durée
                        "
                    >
                        <pre contenteditable><code>
video.controls = false
video.volume += 0.2
video.currentTime = video.duration * 0.5
                        </code></pre>
                    </div>
                </section>

                <section>
                    <h2>Événements</h2>
                    <div
                        class="code-steps"
                        data-type="javascript"
                        data-trim
                        data-steps="
                            *:;
                            l1c1-l1c23,l4c2:Méthode permettant d'écouter un événement;
                            l1c24-l1c29:Nom de l'événement;
                            l1c32-l3,l4c1:Fonction de 'callback' déclenchée quand l'événement survient;
                            l1c33-l1c38,l3c17-l3c22:Contient divers information sur l'événement
                        "
                    >
                        <pre contenteditable><code>
video.addEventListener('play', (_event) =>
{
    console.log(_event)
})
                        </code></pre>
                    </div>
                    <div style="width:60%;margin:0 auto;">
                        <ul style="float:left;">
                            <li>play</li>
                            <li>pause</li>
                            <li>playing</li>
                            <li>seeking</li>
                        </ul>
                        <ul style="float:right;">
                            <li>canplay</li>
                            <li>canplaythrough</li>
                            <li>progress</li>
                            <li><a href="http://www.w3schools.com/tags/ref_av_dom.asp" target="_blank">...</a></li>
                        </ul>
                    </div>
                </section>

                <section>
                    <h2>Méthodes / Propriétés / Événements</h2>
                    <p>Liste complète : <a target="_blank" href="http://www.w3schools.com/tags/ref_av_dom.asp">http://www.w3schools.com/tags/ref_av_dom.asp</a></p>
                </section>

                <section>
                    <h2>Exemples</h2>
                    <p><small>Écouter l'événement <span class="u">click</span> sur un bouton pour augmenter le volume sans dépasser la limite</small></p>

                    <div
                        class="code-steps"
                        data-type="html"
                        data-trim
                        data-steps="
                            *:
                        "
                    >
                        <pre contenteditable><code>
&lt;video src="#"&gt;&lt;/video&gt;
&lt;button class="volume-up"&gt;+&lt;/button&gt;
                        </code></pre>
                    </div>


                    <div
                        class="code-steps"
                        data-type="javascript"
                        data-trim
                        data-steps="
                            *:;
                            l1-l2:Stock les éléments dans des variables;
                            l4-l4c35,l14c2:Écoute l'événement de click sur le bouton volumeUp;
                            l4c36-l14c1:Fonction de 'callback' qui sera déclenchée quand l'utilisateur cliquera;
                            l6c38-l6c55:On incrémente le volume de 0.1;
                            l6c20-l6:Mais on le 'clamp' entre 0 et 1
                        "
                    >
                        <pre contenteditable><code>
const video = document.querySelector('video')
const volumeUp = document.querySelector('.volume-up')

volumeUp.addEventListener('click', () =>
{
    video.volume = Math.min(Math.max(video.volume + 0.1, 0), 1)
})
                        </code></pre>
                    </div>
                </section>

                <section>
                    <h2>Exemples</h2>
                    <p><small>Écouter l'événement <span class="u">click</span> sur une div pour changer la position de la lecture<br>(CSS non inclus)</small></p>

                    <div
                        class="code-steps"
                        data-type="html"
                        data-trim
                        data-steps="
                            *:
                        "
                    >
                        <pre contenteditable><code>
&lt;video src="#"&gt;&lt;/video&gt;
&lt;div class="bar"&gt;&lt;/div&gt;
                        </code></pre>
                    </div>

                    <div
                        class="code-steps"
                        data-type="javascript"
                        data-trim
                        data-steps="
                            *:;
                            l1-l2:Stock les éléments dans des variables;
                            l4-l4c30,l10c2:Écoute l'événement de click sur la bar;
                            l4c30-l10c1:Fonction de 'callback' qui sera déclenchée quand l'utilisateur cliquera;
                            l6:Calcule la position du click sur la bar entre 0 et 1 (0 si click tout à gauche, 1 si click tout à droite);
                            l7:Calcule la position de lecture correspondant à ce ratio (en secondes);
                            l9:Met à jour la position de lecture de la vidéo
                        "
                    >
                        <pre contenteditable><code>
const video = document.querySelector('video')
const bar = document.querySelector('.bar')

bar.addEventListener('click', (_event) =>
{
    const ratio = (_event.clientX - bar.offsetLeft) / bar.offsetWidth
    const current = video.duration * ratio

    video.currentTime = current
})
                        </code></pre>
                    </div>
                </section>

                <section>
                    <h2>Exemples</h2>
                    <p><small>Mettre à jour le curseur d'une barre en fonction de l'avancement dans la vidéo<br>(CSS non inclus)</small></p>

                    <div
                        class="code-steps"
                        data-type="html"
                        data-trim
                        data-steps="
                            *:
                        "
                    >
                        <pre contenteditable><code>
&lt;video src="#"&gt;&lt;/video&gt;
&lt;div class="bar"&gt;
    &lt;div class="cursor"&gt;&lt;/div&gt;
&lt;/div&gt;
                        </code></pre>
                    </div>

                    <div
                        class="code-steps"
                        data-type="javascript"
                        data-trim
                        data-steps="
                            *:;
                            l1-l3:Stock les éléments dans des variables;
                            l5-l5c19,l10c2-l10c6:Déclenche une fonction toutes les 50ms;
                            l5c20-l10c1:Fonction de 'callback' qui sera déclenchée toutes les 50ms;
                            l7:Calcule la progression de lecture de la vidéo entre 0 et 1;
                            l9:Scale la bar de lecture
                        "
                    >
                        <pre contenteditable><code>
const video = document.querySelector('video')
const bar = document.querySelector('.bar')
const cursor = document.querySelector('.cursor')

window.setInterval(() =>
{
    const ratio = video.currentTime / video.duration

    cursor.style.transform = `scaleX(${ratio})`
}, 50)
                        </code></pre>
                    </div>
                </section>

                <section>
                    <h2>Les années d'avant</h2>
                    <ul>
                        <li><a href="./demos/belolo_samuel/index.html" target="_blank">Belolo Samuel</a></li>
                        <li><a href="./demos/clerc_jonathan/index.html" target="_blank">Clerc Jonathan</a></li>
                        <li><a href="./demos/david_berenice/index.html" target="_blank">David Berenice</a></li>
                        <li><a href="./demos/guerin_felix/index.html" target="_blank">Guerin Felix</a></li>
                        <li><a href="./demos/leonard_de_juvigny_remi/index.html" target="_blank">Leonard de Juvigny Remi</a></li>
                        <li><a href="./demos/quercia_joseph/index.html" target="_blank">Quercia Joseph</a></li>
                        <li><a href="./demos/timsit_victor/index.html" target="_blank">Timsit Victor</a></li>
                        <li><a href="./demos/villain_baptiste/index.html" target="_blank">Villain Baptiste</a></li>
                    </ul>
                </section>
            </div>
        </div>

        <script src="../src/caniuse-embed.min.js"></script>
        <script src="../src/reveal.js/lib/js/head.min.js"></script>
        <script src="../src/reveal.js/js/reveal.js"></script>

        <!-- Code steps start -->
        <script src="../src/code-steps/prism.js" data-manual></script>
        <!-- Code steps end -->

        <script type="module" src="../src/custom/script-module.js"></script>
    </body>
</html>
